<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pok√©mon Collection</title>
    <link rel="stylesheet" href="css/style-display.css" />
    <!-- Anime.js for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
  </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar">
      <div class="nav-content">
        <h1 class="nav-logo">Pok√©mon Collection</h1>
        <div class="nav-actions">
          <span class="user-welcome" id="userWelcome"></span>
          <span class="pokecoins-display" id="pokecoinsDisplay" style="margin-right: 15px; font-weight: bold; color: #ffd700;">üí∞ <span id="pokecoinsValue">0</span> PokeCoins</span>
          <button id="music-toggle" class="music-btn" style="margin-right: 10px;">üîä</button>
          <button onclick="window.location.href='collection.html'" class="nav-btn">
            My Collection
          </button>
          <button onclick="window.location.href='battle.html'" class="nav-btn">
            Battle
          </button>
          <button id="addPokemonBtn" onclick="window.location.href='index.html'" class="nav-btn add-btn" style="display: none;">
            + Add Pok√©mon
          </button>
          <button onclick="signOut()" class="nav-btn signout-btn">
            Sign Out
          </button>
        </div>
      </div>
    </nav>

    <div class="main-container">
      <!-- Filter Section -->
      <div class="filter-section">
        <div class="search-box">
          <input 
            type="text" 
            id="searchInput" 
            placeholder="üîç Search by name..." 
            class="search-input"
          />
        </div>
        
        <div class="filter-controls">
          <div class="filter-group">
            <label>Type:</label>
            <select id="typeFilter" class="filter-select">
              <option value="">All Types</option>
              <option value="Fire">üî• Fire</option>
              <option value="Water">üíß Water</option>
              <option value="Electric">‚ö° Electric</option>
              <option value="Grass">üåø Grass</option>
              <option value="Ice">‚ùÑÔ∏è Ice</option>
              <option value="Ground">üèîÔ∏è Ground</option>
              <option value="Dark">üåë Dark</option>
              <option value="Psychic">üîÆ Psychic</option>
              <option value="Fighting">ü•ä Fighting</option>
              <option value="Dragon">üêâ Dragon</option>
              <option value="Normal">‚≠ê Normal</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label>Sort by:</label>
            <select id="sortOption" class="filter-select">
              <option value="name">Name</option>
              <option value="health">Health</option>
              <option value="power">Power</option>
              <option value="type">Type</option>
            </select>
          </div>
          
          <button id="applyFiltersBtn" class="apply-btn">Apply Filters</button>
        </div>
      </div>

      <!-- Cards Grid -->
      <div class="cards-grid" id="cardContainer">
        <!-- Cards will be dynamically inserted here -->
      </div>

      <!-- Empty State -->
      <div class="empty-state" id="emptyState" style="display: none;">
        <div class="empty-icon">üì¶</div>
        <h2>No Pok√©mon Cards Found</h2>
        <p>Start building your collection by adding new Pok√©mon cards!</p>
        <button onclick="window.location.href='index.html'" class="empty-btn">
          Add Your First Card
        </button>
      </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Edit Pok√©mon Card</h2>
          <span class="close">&times;</span>
        </div>
        <form id="editForm">
          <input type="hidden" id="editId" />
          
          <div class="form-group">
            <label for="editName">Name:</label>
            <input type="text" id="editName" required />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="editHealth">Health:</label>
              <input type="number" id="editHealth" required />
            </div>

            <div class="form-group">
              <label for="editPower">Power:</label>
              <input type="number" id="editPower" required />
            </div>
          </div>

          <div class="form-group">
            <label for="editType">Type:</label>
            <select id="editType" required>
              <option value="Fire">Fire</option>
              <option value="Water">Water</option>
              <option value="Electric">Electric</option>
              <option value="Grass">Grass</option>
              <option value="Ice">Ice</option>
              <option value="Ground">Ground</option>
              <option value="Dark">Dark</option>
              <option value="Psychic">Psychic</option>
              <option value="Fighting">Fighting</option>
              <option value="Dragon">Dragon</option>
              <option value="Normal">Normal</option>
            </select>
          </div>

          <div class="form-group">
            <label for="editPrice">Price (PokeCoins):</label>
            <input type="number" id="editPrice" min="1" required />
          </div>

          <button type="button" onclick="submitEdit()" class="modal-btn">
            Save Changes
          </button>
        </form>
      </div>
    </div>

    <script>
      function signOut() {
        localStorage.clear();
        window.location.href = "landing.html";
      }

      function initMusic() {
        // Use global music manager
        musicManager.setPage('display');

        const bgMusic = document.getElementById('bg-music');
        const battleMusic = document.getElementById('battle-music');
        const musicToggle = document.getElementById('music-toggle');

        if (!bgMusic || !battleMusic || !musicToggle) {
          console.error('Audio elements not found!');
          return;
        }

        // Set sources
        bgMusic.src = 'audio/background.mp3';
        battleMusic.src = 'audio/Battle_Music.mp3';

        // Preload audio
        bgMusic.load();
        battleMusic.load();

        // Set initial mute state
        bgMusic.muted = musicManager.isMuted;
        battleMusic.muted = musicManager.isMuted;
        musicToggle.textContent = musicManager.isMuted ? 'üîá' : 'üîä';

        // Play background music
        setTimeout(() => {
          musicManager.playMusic('display');
        }, 500);

        // Music toggle - instant on/off
        musicToggle.addEventListener('click', function() {
          musicManager.toggleMute();
        });
      }

      // Display username and manage role-based UI
      document.addEventListener("DOMContentLoaded", function () {
        const username = localStorage.getItem("username");
        const role = localStorage.getItem("role");
        const pokecoins = localStorage.getItem("pokecoins");
        
        if (!username) {
          window.location.href = "landing.html";
        } else {
          document.getElementById("userWelcome").textContent = `Welcome, ${username}!`;
          document.getElementById("pokecoinsValue").textContent = pokecoins || "0";
          
          // Show Add Pokemon button only for admin
          if (role === "admin") {
            document.getElementById("addPokemonBtn").style.display = "inline-block";
          }
          
          initMusic();
          
          // Hide PokeCoins display for admin
          if (role === "admin") {
            document.getElementById("pokecoinsDisplay").style.display = "none";
          }
        }
      });
    </script>
    <script src="js/card-handler.js" defer></script>
    <script src="js/music-manager.js"></script>

    <!-- Audio elements -->
    <audio id="bg-music" loop preload="auto"></audio>
    <audio id="battle-music" loop preload="auto"></audio>
  </body>
</html>
