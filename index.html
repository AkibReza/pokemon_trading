<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Pok√©mon Card</title>
    <link rel="stylesheet" href="css/style-index.css" />
  </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar">
      <div class="nav-content">
        <h1 class="nav-logo">Pok√©mon Collection</h1>
        <div class="nav-actions">
          <span class="user-welcome" id="userWelcome"></span>
          <span class="pokecoins-display" id="pokecoinsDisplay" style="margin-right: 15px; font-weight: bold; color: #ffd700;">üí∞ <span id="pokecoinsValue">0</span> PokeCoins</span>
          <button id="music-toggle" class="music-btn" style="margin-right: 10px;">üîä</button>
          <button onclick="window.location.href='display.html'" class="nav-btn">
            View Collection
          </button>
          <button onclick="window.location.href='collection.html'" class="nav-btn">
            My Cards
          </button>
          <button onclick="signOut()" class="nav-btn signout-btn">
            Sign Out
          </button>
        </div>
      </div>
    </nav>

    <div class="main-container">
      <div class="form-wrapper">
        <div class="form-header">
          <h1>Add a New Pok√©mon Card</h1>
          <p>Fill in the details to add a card to your collection</p>
        </div>

        <form id="cardForm" class="pokemon-form">
          <div class="form-group">
            <label for="name">Pok√©mon Name</label>
            <input 
              type="text" 
              id="name" 
              name="name" 
              placeholder="e.g., Pikachu"
              required 
            />
          </div>

          <div class="form-group">
            <label for="image_file">Upload Image</label>
            <input 
              type="file" 
              id="image_file" 
              name="image_file" 
              accept="image/*"
              onchange="previewImage(event)"
            />
            <small>Supported formats: JPG, PNG, GIF (Max 5MB)</small>
            <div id="imagePreview" class="image-preview"></div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="health">Health (HP)</label>
              <input 
                type="number" 
                id="health" 
                name="health" 
                placeholder="100"
                min="1"
                required 
              />
            </div>

            <div class="form-group">
              <label for="power">Power</label>
              <input 
                type="number" 
                id="power" 
                name="power" 
                placeholder="50"
                min="1"
                required 
              />
            </div>
          </div>

          <div class="form-group">
            <label for="type">Type</label>
            <select id="type" name="type" required>
              <option value="">Select a type</option>
              <option value="Fire">üî• Fire</option>
              <option value="Water">üíß Water</option>
              <option value="Electric">‚ö° Electric</option>
              <option value="Grass">üåø Grass</option>
              <option value="Ice">‚ùÑÔ∏è Ice</option>
              <option value="Ground">üèîÔ∏è Ground</option>
              <option value="Dark">üåë Dark</option>
              <option value="Psychic">üîÆ Psychic</option>
              <option value="Fighting">ü•ä Fighting</option>
              <option value="Dragon">üêâ Dragon</option>
              <option value="Normal">‚≠ê Normal</option>
            </select>
          </div>

          <div class="form-group">
            <label for="price">Price (PokeCoins)</label>
            <input 
              type="number" 
              id="price" 
              name="price" 
              placeholder="100"
              min="1"
              required 
            />
          </div>

          <div class="form-actions">
            <button type="button" onclick="submitForm()" class="submit-btn">
              Add Pok√©mon
            </button>
            <button 
              type="button" 
              onclick="window.location.href='display.html'" 
              class="cancel-btn"
            >
              Cancel
            </button>
          </div>
        </form>

        <div id="responseMessage" class="response-message"></div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const username = localStorage.getItem("username");
        const pokecoins = localStorage.getItem("pokecoins");
        if (!username) {
          window.location.href = "landing.html";
        } else {
          document.getElementById("userWelcome").textContent = `Welcome, ${username}!`;
          document.getElementById("pokecoinsValue").textContent = pokecoins || "0";
          initMusic();
        }
      });

      function signOut() {
        localStorage.clear();
        window.location.href = "landing.html";
      }

      function previewImage(event) {
        const previewDiv = document.getElementById('imagePreview');
        const file = event.target.files[0];
        
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            previewDiv.innerHTML = `<img src="${e.target.result}" alt="Preview" style="max-width: 200px; max-height: 200px; border-radius: 8px; margin-top: 10px;">`;
          }
          reader.readAsDataURL(file);
        } else {
          previewDiv.innerHTML = '';
        }
      }

      function initMusic() {
        // Use global music manager
        musicManager.setPage('index');

        const bgMusic = document.getElementById('bg-music');
        const battleMusic = document.getElementById('battle-music');
        const muteBtn = document.getElementById('music-toggle');

        if (!bgMusic || !battleMusic || !muteBtn) {
          console.error('Audio elements not found!');
          return;
        }

        // Set sources
        bgMusic.src = 'audio/background.mp3';
        battleMusic.src = 'audio/Battle_Music.mp3';

        // Preload audio
        bgMusic.load();
        battleMusic.load();

        // Set initial mute state
        bgMusic.muted = musicManager.isMuted;
        battleMusic.muted = musicManager.isMuted;
        muteBtn.textContent = musicManager.isMuted ? 'üîá' : 'üîä';

        // Play background music
        setTimeout(() => {
          musicManager.playMusic('index');
        }, 500);

        // Music toggle - instant on/off
        muteBtn.addEventListener('click', function() {
          musicManager.toggleMute();
        });
      }
    </script>
    <script src="js/music-manager.js"></script>
    <script src="js/form-handler.js"></script>

    <!-- Audio elements -->
    <audio id="bg-music" loop preload="auto"></audio>
    <audio id="battle-music" loop preload="auto"></audio>
  </body>
</html>
